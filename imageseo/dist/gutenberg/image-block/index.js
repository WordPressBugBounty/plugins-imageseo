(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};window.React;const t=window.wp.components,r=window.wp.blockEditor,a=window.wp.data,i=window.wp.compose,n=window.wp.apiFetch;var o=e.n(n);const s=async e=>{try{return await o()({path:"imageseo/v1/generate-alt-text/",method:"POST",data:e})}catch(e){console.error("Error calling the api:",e)}},l=window.wp.i18n,c=window.wp.element,g=(0,i.createHigherOrderComponent)((e=>i=>{const[n,o]=(0,c.useState)(!1),{setError:g}=(0,a.useDispatch)("imageseo");if("core/image"!==i.name)return React.createElement(e,i);const{error:m}=(0,a.useSelect)((e=>({error:e("imageseo").getError()})),[]),{updateBlockAttributes:d}=(0,a.useDispatch)("core/block-editor");return React.createElement(React.Fragment,null,React.createElement(e,i),React.createElement(r.InspectorControls,null,React.createElement("div",{className:"components-panel__body is-opened"},m?React.createElement("div",{className:"error"},"ImageSEO Error: ",m):React.createElement(t.Button,{isPrimary:!0,onClick:async()=>{o(!0);const{id:e,url:t}=i.attributes,r=await s({id:e,url:t});r.error&&g(r.error),o(!1),d(i.clientId,{alt:r.altText})},className:"components-button editor-post-featured-image__toggle",isBusy:n},(0,l.__)("Generate alt with ImageSEO","imageseo")))))}),"withImageAltButton"),m=window.wp.editPost,d=window.wp.plugins,u=()=>{const{updateBlockAttributes:e}=(0,a.useDispatch)("core/block-editor"),{updateSettings:r,setUpdating:i,setError:n}=(0,a.useDispatch)("imageseo"),{settings:o,isUpdating:c,error:g}=(0,a.useSelect)((e=>({settings:e("imageseo").getSettings(),isUpdating:e("imageseo").isUpdating(),error:e("imageseo").getError()})),[]),{totalImages:m,imagesWithAlt:d,percentage:u,imageBlocks:p}=(0,a.useSelect)((e=>{const{getClientIdsWithDescendants:t,getBlock:r}=e("core/block-editor"),a=t().map((e=>r(e))).filter((e=>"core/image"===e.name)),i=a.length,n=a.filter((e=>e.attributes.alt&&""!==e.attributes.alt.trim())).length;return{totalImages:i,imagesWithAlt:n,percentage:i>0?Math.round(n/i*100):0,imageBlocks:a}}),[]);return React.createElement("div",{className:"imageseo-panel-content"},React.createElement("p",{className:"description"},(0,l.__)("Add alt text from your media library to images. For images without alt text, new descriptions will be automatically generated.","imageseo")),React.createElement("div",{className:"alt-text-stats"},m>0?React.createElement("p",null,(0,l.__)("Alt Text","imageseo")," ",React.createElement("strong",null,d,"/",m," ",(0,l.__)("images","imageseo")," (",u,"%)")):React.createElement("p",null,(0,l.__)("No images found in the content","imageseo"))),React.createElement(t.CheckboxControl,{label:(0,l.__)("Overwrite existing alt text","imageseo"),checked:o.overwriteExisting,onChange:e=>r({overwriteExisting:e})}),React.createElement(t.CheckboxControl,{label:(0,l.__)("Include images not in library","imageseo"),checked:o.includeNonLibrary,onChange:e=>r({includeNonLibrary:e})}),g?React.createElement("div",{className:"error"},"ImageSEO Error: ",g):React.createElement(t.Button,{variant:"secondary",className:"refresh-alt-text-button",onClick:async()=>{i(!0);try{const t=4;for(let r=0;r<p.length;r+=t){const a=p.slice(r,r+t);await Promise.all(a.map((async t=>{const{id:r,url:a}=t.attributes;if(!o.overwriteExisting&&t.attributes.alt?.trim())return;if(!o.includeNonLibrary&&!r)return;const i=await s({id:r,url:a});if(i.error)return n(i.error),void console.warn(`Error generating alt text for image ${r||a}:`,i.error);e(t.clientId,{alt:i.altText})})))}}catch(e){n(e),console.error("Error updating alt text:",e)}finally{i(!1)}},isBusy:c,disabled:c,icon:"update"},c?(0,l.__)("Updating all altsâ€¦","imageseo"):(0,l.__)("Update all alts","imageseo")))},p={settings:{overwriteExisting:!1,includeNonLibrary:!1},isUpdating:!1,error:null},E=(0,a.createReduxStore)("imageseo",{reducer(e=p,t){switch(t.type){case"UPDATE_SETTINGS":return{...e,settings:{...e.settings,...t.settings}};case"SET_UPDATING":return{...e,isUpdating:t.isUpdating};case"SET_ERROR":return{...e,error:t.error};default:return e}},actions:{updateSettings:e=>({type:"UPDATE_SETTINGS",settings:e}),setUpdating:e=>({type:"SET_UPDATING",isUpdating:e}),setError:e=>({type:"SET_ERROR",error:e})},selectors:{getSettings:e=>e.settings,isUpdating:e=>e.isUpdating,getError:e=>e.error}});(0,a.register)(E),window.addEventListener("DOMContentLoaded",(()=>{wp.hooks.addFilter("editor.BlockEdit","imageseo/with-image-alt-button",g),(0,d.registerPlugin)("imageseo-settings",{render:()=>React.createElement(m.PluginDocumentSettingPanel,{name:"imageseo-panel",title:(0,l.__)("Image SEO","imageseo"),className:"imageseo-panel"},React.createElement(u,null)),icon:"format-image"})}))})();